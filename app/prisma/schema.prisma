generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model masjid {
  id              BigInt            @id @default(autoincrement())
  nama_masjid     String
  nama_ketua_dkm  String
  no_hp           String
  jumatan         jumatan[]
  masjid_mubaligh masjid_mubaligh[]
  pengajian       pengajian[]
}

model mubaligh {
  id              BigInt            @id @default(autoincrement())
  nama_mubaligh   String
  no_hp           String
  jumatan         jumatan[]
  masjid_mubaligh masjid_mubaligh[]
  pengajian       pengajian[]
}

model pengajian {
  id          BigInt   @id @default(autoincrement())
  tanggal     DateTime @db.Date
  waktu       String
  id_masjid   BigInt
  id_mubaligh BigInt
  broadcasted Boolean  @default(false)
  masjid      masjid   @relation(fields: [id_masjid], references: [id], onDelete: Cascade, onUpdate: NoAction)
  mubaligh    mubaligh @relation(fields: [id_mubaligh], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model template {
  id            BigInt     @id @default(autoincrement())
  nama_template String     @unique
  content       String
  type          template_t
}

model user {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  username String @unique
  password String
}

model masjid_mubaligh {
  id_masjid   BigInt
  id_mubaligh BigInt
  masjid      masjid   @relation(fields: [id_masjid], references: [id], onDelete: Cascade, onUpdate: NoAction)
  mubaligh    mubaligh @relation(fields: [id_mubaligh], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([id_masjid, id_mubaligh])
}

model message_logs {
  id           BigInt           @id @default(autoincrement())
  no_hp        String
  message      String
  status       message_status_t
  send_time    DateTime         @db.Timestamptz(6)
  error_reason String?
}

model jumatan {
  id          BigInt   @id @default(autoincrement())
  tanggal     DateTime @db.Timestamptz(6)
  id_masjid   BigInt
  id_mubaligh BigInt
  broadcasted Boolean  @default(false)
  masjid      masjid   @relation(fields: [id_masjid], references: [id], onDelete: Cascade, onUpdate: NoAction)
  mubaligh    mubaligh @relation(fields: [id_mubaligh], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

enum template_t {
  pengajian_bulanan
  pengajian_reminder
  jumatan_reminder
}

enum message_status_t {
  success
  failed
}
